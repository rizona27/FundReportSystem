# 基金报告推送系统说明文档

## 一、系统概述

基金报告推送系统是一款基于PyQt5开发的基金数据管理与报告推送工具，能够自动获取基金净值数据，计算持仓收益与年化收益率，并通过多种渠道（手机端、电脑端）推送定制化报告。系统支持多维度报告生成（按基金分类、按客户分类）及目标收益筛选，适用于需要跟踪多客户基金持仓情况的场景。


## 二、核心功能

1. **数据获取与处理**
   - 自动从多个冗余接口获取基金最新净值数据
   - 验证并清洗基金持仓数据（支持批量导入）
   - 计算持仓收益、绝对收益率及年化收益率

2. **多渠道推送**
   - 手机端：支持Bark（IOS）、Gotify（Android）、企业微信推送
   - 电脑端：生成本地报告文件（按基金/客户分类）

3. **报告生成**
   - 客户持仓详情报告：包含每支基金的购买信息、收益情况
   - 基金汇总报告：统计某支基金的所有客户持仓情况
   - 目标收益报告：筛选出年化收益率达标的基金持仓

4. **系统特性**
   - 自动重试机制：网络异常时自动重试数据获取与推送
   - 数据校验：验证基金代码、日期格式、金额数值的有效性
   - 日志记录：详细记录操作过程与异常信息
   - 配置持久化：保存用户设置，下次启动自动加载


## 三、系统要求

| 项目 | 要求 |
|------|------|
| 操作系统 | Windows 7/8/10/11 |
| Python环境 | Python 3.6及以上（源码运行时） |
| 依赖库 | PyQt5、requests、urllib3 |
| 网络 | 需联网（用于获取基金数据及推送报告） |


## 四、安装与运行

### 4.1 源码运行

1. 安装依赖库：
   ```bash
   pip install PyQt5 requests urllib3
   ```

2. 下载源码文件（假设保存为`fund_report.py`）

3. 运行程序：
   ```bash
   python fund_report.py
   ```

### 4.2 可执行文件运行

对于打包后的`.exe`文件，直接双击运行即可，程序会自动创建必要的配置目录。


## 五、使用指南

### 5.1 初始配置

1. **数据文件准备**  
   系统首次运行会自动在程序目录的`config`文件夹下创建`funds.txt`示例文件，格式如下：
   ```
   # 格式：用户名,基金代码,买入日期,买入金额(元),持仓份额
   张三,163406,2023-01-01,100000.00,50000.00
   李四,001718,2024-01-01,80000.00,40000.00
   ```
   - 需使用纯文本编辑器编辑（如记事本、VS Code）
   - 注释行以`#`开头，程序会自动忽略
   - 日期格式必须为`YYYY-MM-DD`


2. **基本配置（主界面）**  
   - **手机端推送**：勾选"启用手机端推送"，并选择至少一种推送方式（Bark/Gotify/企业微信）
   - **电脑端推送**：勾选"启用电脑端推送"，并选择报告分类方式（按基金/按客户）


3. **高级配置**  
   点击"高级设置"按钮，配置推送渠道参数：
   - **Bark设置**：填写服务器地址（如`https://api.bark.com`）和设备Token
   - **Gotify设置**：填写服务器地址（如`https://gotify.example.com`）和应用Token
   - **企业微信设置**：填写企业ID（CorpID）、应用ID（AgentID）、应用密钥（Secret）及代理地址
   - **其他设置**：目标年化收益率、消息最大长度、重试次数等


## 四、操作流程

### 4.1 快速开始

1. 启动程序，首次运行会自动创建`config/funds.txt`示例文件
2. 编辑`funds.txt`，填写实际的客户持仓数据
3. 在主界面配置推送方式（手机端/电脑端）
4. 点击"生成并推送报告"按钮，系统开始处理


### 4.2 详细操作

#### 数据准备
- 打开程序目录下的`config/funds.txt`文件
- 按照示例格式填写数据（每行一条持仓记录）：
  ```
  用户名,基金代码,买入日期,买入金额(元),持仓份额
  ```
- 保存文件并关闭编辑器


#### 推送配置
- **手机端推送**：
  - 勾选"启用手机端推送"
  - 选择推送方式（如Bark）
  - 在高级设置中填写对应渠道的参数
- **电脑端推送**：
  - 勾选"启用电脑端推送"
  - 选择报告类型（按基金分类/按客户分类）


#### 报告生成
- 点击"生成并推送报告"按钮，系统会：
  1. 读取并验证`funds.txt`中的数据
  2. 从网络获取基金最新净值
  3. 计算收益与收益率
  4. 按配置生成报告并推送
- 运行过程与结果会显示在"运行日志"区域


#### 报告查看
- **手机端**：通过Bark/Gotify/企业微信接收消息
- **电脑端**：报告保存在程序目录的`report`文件夹下：
  - 按基金分类：`report/by_fund/基金代码_基金名称/时间戳.txt`
  - 按客户分类：`report/by_user/用户名/时间戳.txt`
  - 目标收益报告：`report/已达目标收益.txt`


## 五、配置说明

### 5.1 基础配置（主界面）

| 配置项 | 说明 |
|--------|------|
| 推送到手机端 | 总开关，控制是否启用手机端推送 |
| 启用Bark推送 | 适用于IOS设备，需配置Bark服务器 |
| 启用Gotify推送 | 适用于Android设备，需配置Gotify服务器 |
| 启用企业微信推送 | 通过企业微信接收报告 |
| 推送到电脑端 | 总开关，控制是否生成本地报告文件 |
| 按基金分类生成报告 | 生成以基金代码命名的报告 |
| 按客户分类生成报告 | 生成以客户名称命名的报告 |


### 5.2 高级配置

| 配置项 | 说明 |
|--------|------|
| Bark服务器地址 | Bark服务的URL（如`https://bark.example.com`） |
| Bark应用Token | 设备在Bark服务中注册的Token |
| Gotify服务器地址 | Gotify服务的URL（如`https://gotify.example.com`） |
| Gotify应用Token | Gotify中创建的应用Token |
| 企业ID (CorpID) | 企业微信的CorpID（在企业微信管理后台获取） |
| 应用ID (AgentID) | 企业微信应用的AgentID |
| 应用密钥 (Secret) | 企业微信应用的Secret |
| 代理地址 | 企业微信API代理地址 |
| 目标年化收益率 | 用于筛选达标基金的阈值（默认5.0%） |
| 最大消息长度 | 推送消息的最大字节数（默认2048） |
| 最大重试次数 | 网络异常时的重试次数（默认3次） |
| 重试延迟 | 每次重试的间隔时间（秒，默认5秒） |


## 六、常见问题

### 6.1 数据相关

**Q：程序提示"funds.txt文件不存在"？**  
A：首次运行会自动创建该文件，若创建失败，请手动在`config`文件夹下创建`funds.txt`，并按照示例格式填写数据。

**Q：基金数据获取失败？**  
A：可能原因：
- 基金代码错误（检查`funds.txt`中的代码）
- 网络连接问题（确认网络通畅）
- 接口限制（稍后重试）


### 6.2 推送相关

**Q：手机收不到推送消息？**  
A：检查：
- 推送方式是否勾选（如Bark）
- 高级设置中的参数是否正确
- 网络连接是否正常
- 对应应用（Bark/Gotify/企业微信）是否正常运行

**Q：企业微信推送失败？**  
A：确认：
- 企业ID、应用ID、Secret是否正确
- 代理地址是否可用
- 企业微信应用是否已启用


### 6.3 报告相关

**Q：报告中收益计算错误？**  
A：检查`funds.txt`中的：
- 买入金额与持仓份额是否匹配
- 买入日期格式是否正确（YYYY-MM-DD）

**Q：找不到生成的报告文件？**  
A：报告默认保存在程序目录的`report`文件夹下，可在日志中查看具体路径。


## 七、技术细节

### 7.1 数据接口

系统采用多接口冗余设计，自动切换接口获取基金数据：
1. `fundgz.1234567.com.cn`
2. `j4.esongfund.com`
3. `fund.eastmoney.com/pingzhongdata`


### 7.2 文件结构

```
基金报告推送系统/
├─ config/                # 配置文件目录
│  ├─ config.ini          # 系统配置
│  └─ funds.txt           # 基金持仓数据
├─ report/                # 报告文件目录
│  ├─ by_fund/            # 按基金分类的报告
│  ├─ by_user/            # 按客户分类的报告
│  └─ 已达目标收益.txt     # 目标收益报告
└─ 基金报告推送系统.exe    # 程序可执行文件
```


---

**文档版本**：1.0  
**最后更新**：2025年7月